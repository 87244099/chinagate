const tracker=function(e){let r="https://collecter.frontjs.com/",t="1.0.0-rc.3",n=5e3,o=1,i=256,a=1024,l={};const s=function(e,r){r=r||"";let t={1001:"Invalid token",1002:"Invalid behaviour settings",1003:"Invalid origin settings",1004:"Invalid exclude settings",1005:"Invalid user data",4000:"Bad configuration! Fail to start!",4001:"FrontJS is already defined, Fail to start!"};t[e]&&console.warn(["Error(frontjs):",t[e],"(CODE"+e+")","See https://www.frontjs.com/doc/view/errcode/#"+encodeURIComponent(r)].join(" "))},c=function(e){return e&&e.match(/^\w{32}$/)?0:1},u=function(e){return e<=(14|o)?0:1},f=function(e){e=e||[];for(var r=0;r<e.length;r++)if("string"==typeof e[r]);else if(!e[r].test)return e[r];return 0},g=function(e){for(var r in e=e||{})if("object"==typeof e[r])return r;return 0},p=wx.getSystemInfoSync(),d={unknown:0,none:1,wifi:3,"2g":4,"3g":5,"4g":6};let m=null,h=null,y=null,v=0,w=null,D=[/\[(\d|\s|:|-)*\]\s*request\s+(begin|success|fail)/g];const S={KVArrayCopy:function(e){var r={};for(var t in e)r[t]=e[t];return r},uriArrayCopy:function(e){e=e||[];for(var r=[],t=0;t<e.length;t++)"string"==typeof e[t]?r.push(e[t]):r.push(new RegExp(e[t].source,e[t].flag));return r},getTime:function(){return(new Date).getTime()},getGUID:function(){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],r=S.getTime().toString(16);for(r="0"+r;r.length<16;)r="f"+r;for(;r.length<32;)r+=e[Math.floor(16*Math.random())];return r},stringifyParameter:function(e){var r=[];if(e&&e.length){for(var t=0;t<e.length;t++)if(null===e[t])r.push("null");else if(void 0===e[t])r.push("undefined");else if(e[t]instanceof Array&&"string"==typeof e[t].toString())r.push("["+e[t].toString()+"]");else if("object"==typeof e[t]){var n=[];for(var o in e[t]){var i="";if(i+=o+": ",null===e[t][o])i+="null";else if(void 0===e[t][o])i+="undefined";else{switch(typeof e[t][o]){case"object":e[t][o]instanceof Array&&"string"==typeof e[t][o].toString()?i+="["+e[t][o].toString()+"]":"function"==typeof e[t][o].valueOf&&"string"==typeof e[t][o].valueOf()?i+=e[t][o].valueOf():"function"==typeof e[t][o].toString&&"string"==typeof e[t][o].toString()?i+=e[t][o].toString():i+="[object]";break;case"function":i+="[function]";break;default:i+=e[t][o].toString()}}n.push(i)}r.push("{"+n.join(", ")+"}")}else"function"==typeof e[t].valueOf&&"string"==typeof e[t].valueOf()?r.push(e[t].valueOf()):"function"==typeof e[t].toString&&"string"==typeof e[t].toString()?r.push(e[t].toString()):r.push("[object]");return r.join(", ")}return"[object]"},addSlashes:function(e){return e.replace(/(\.|\\|\/|\||\+|\$|\^)/g,"\\$1")},filterTrace:function(e){var r=new RegExp("((?!\\n).)*"+S.addSlashes("tracker.min.js")+".*\\n","g");return e.replace(r,"")},getUserAgent:function(){return"N/A"},getCurrentURL:function(){return h},getRefererURL:function(){return m},getViewPortSize:function(){return{w:p.windowWidth,h:p.windowHeight,r:p.pixelRatio}},getClientID:function(){return wx.getStorageSync("frontjs:client:id")||wx.setStorageSync("frontjs:client:id",S.getGUID()),wx.getStorageSync("frontjs:client:id")},getSessionID:function(){return y||(y=S.getGUID()),y},checkCrossOrigin:function(e,r){if(r){e=e||"";for(var t=!1,n=0;n<r.length;n++)""!==r[n]&&e.match(r[n])&&(t|=!0);return!t}return!1},checkIgnorePattern:function(e){if(e)for(var r=0;r<D.length;r++)if(e.match(D[r]))return!0;return!1},checkTimingSlow:function(e,r){return!!r&&(e.send>r.sned&&r.sned>0||e.load>r.load&&r.load>0||e.total>r.total&&r.total>0)},calculateTrackerTiming:function(e){if(e._time_done&&e._time_load&&e._time_send&&e._time_done){var r=e._time_send-e._time_open,t=e._time_load-e._time_send,n=e._time_done-e._time_open;return{send:r=r<0?null:r,load:t=t<0?null:t,total:n=n<0?null:n}}return{send:0,load:0,total:0}},composeTrackerData:function(e,r){return{type:e,data:r}},composeScriptErrorData:function(e,r,t,n,o,i){return i=i&&i.stack?i.stack.toString():"",{message:e,detail:{err:r,file:t,line:n,column:o,trace:i=S.filterTrace(i)}}},composeXHRErrorData:function(e,r,t,n){return{message:e,detail:{requestURL:r,responseData:t,timing:n}}},composeResourceErrorData:function(e,r,t,n=null){return n?{message:e,detail:{tagname:r,resourceURL:t,response:n.response}}:{message:e,detail:{tagname:r,resourceURL:t}}},composePerformaceData:function(e,r){return{message:e,detail:r}}};let k=function(e){var t={},n=!0;if(c(e.token)?(s(1001),n&=!1):t.token=e.token.toString(),u(e.behaviour)?(s(1002),n&=!1):(t.behaviour=parseInt(e.behaviour),t.behaviour||(t.behaviour=14|o)),f(e.origin)){var i=f(e.behaviour);s(1003,i),n&=!1}else t.origin=S.uriArrayCopy(e.origin),t.origin.push(/^((?!:\/\/).)*$/),t.origin.push("tracker.min.js"),t.origin.push(r);return f(e.exclude)?(i=f(e.exclude),s(1004,i),n&=!1):(t.exclude=S.uriArrayCopy(e.exclude),t.exclude.push("tracker.min.js"),t.exclude.push(r)),g(e.userData)?(i=g(e.userData),s(1005,i),n&=!1):t.userData=S.KVArrayCopy(e.userData),!!n&&t}(e);if(!k)return s(4e3),!1;(l={}).brand=p.brand,l.model=p.model,l.osType=p.platform,l.osversion=p.system,l.deviceID=S.getClientID(),l.freeDiskSpace=null,l.freeRam=null,l.isRoot=null,l.isPortrait=null,l.name=null,l.network=null,wx.getNetworkType({success:function(e){l.network=d[e.networkType]}}),wx.onNetworkStatusChange(function(e){l.network=d[e.networkType]});let b={request:function(e){let r=e[0].success,t=e[0].fail,n=S.getTime(),o=0;e[0].success=function(){o=S.getTime();let t=S.composeXHRErrorData(771,e[0].url,{status:arguments[0].statusCode},{send:0,load:o-n,total:o-n});S.checkCrossOrigin(e[0].url,k.exclude)&&4&k.behaviour&&E(768,t),r&&r.apply(this,[].slice.call(arguments))},e[0].fail=function(){o=S.getTime();let r=S.composeXHRErrorData(769,e[0].url,{status:0},{send:o-n,load:0,total:o-n});S.checkCrossOrigin(e[0].url,k.exclude)&&4&k.behaviour&&E(768,r),t&&t.apply(this,[].slice.call(arguments))}},downloadFile:function(e){let r=e[0].success,t=e[0].fail,n=S.getTime(),o=0;e[0].success=function(){o=S.getTime();let t=S.composeResourceErrorData(515,"wx.downloadFile",e[0].url,{response:o-n});S.checkCrossOrigin(e[0].url,k.exclude)&&2&k.behaviour&&e[0].url&&E(512,t),r&&r.apply(this,[].slice.call(arguments))},e[0].fail=function(){let r=S.composeResourceErrorData(513,"wx.downloadFile",e[0].url);S.checkCrossOrigin(e[0].url,k.exclude)&&2&k.behaviour&&e[0].url&&E(512,r),t&&t.apply(this,[].slice.call(arguments))}}};if(wx.tracker)return s(4001),null;{let e=wx,r={};for(var R in wx)if(b[R]){let t=R.toString();r[t]=function(){return b[t](arguments),e[t].apply(e,[].slice.call(arguments))}}else r[R]=e[R];r.tracker=!0,wx=r}let x=Page;Page=function(){let e=arguments,r=e[0].onShow,t=e[0].onHide;e[0].onShow=function(){let e=getCurrentPages();m=h,h=e.length>0?e[e.length-1].route:"",v=S.getTime(),r&&r.apply(this,[].slice.call(arguments)),w=S.getGUID();let t=S.composePerformaceData(a,{view:0});E(a,t)},e[0].onHide=function(){let e=S.getTime()-v,r=S.composePerformaceData(a,{view:e});E(a,r),t&&t.apply(this,[].slice.call(arguments))},x.apply(null,[].slice.call(arguments))};let T=App;if(App=function(){let e=arguments,r=e[0].onError;e[0].onError=function(){A.catch(arguments[0]),r&&r.apply(this,[].slice.call(arguments))},e[0].FrontJS=L,T.apply(null,[].slice.call(arguments))},console){var I=console.log,U=console.warn,C=console.error;console.log=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var r=S.composeScriptErrorData(257,S.stringifyParameter(e).substr(0,1e3),"via console.log",0,0,new Error(S.stringifyParameter(e).substr(0,1e3)));k.behaviour&o&&E(i,r),I.apply(console,e)},console.warn=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var r=S.composeScriptErrorData(258,S.stringifyParameter(e).substr(0,1e3),"via console.warn",0,0,new Error(S.stringifyParameter(e).substr(0,1e3)));k.behaviour&o&&E(i,r),U.apply(console,e)},console.error=function(){var e=[].slice.call(arguments);if(!e.length)return!0;var r=S.composeScriptErrorData(259,S.stringifyParameter(e).substr(0,1e3),"via console.error",0,0,new Error(S.stringifyParameter(e).substr(0,1e3)));k.behaviour&o&&E(i,r),C.apply(console,e)}}function E(e,r){var n=!1,o=S.composeTrackerData(e,r);o.currentURL=S.getCurrentURL(),o.refererURL=S.getRefererURL(),o.currentRoute=o.currentURL,o.refererRoute=o.refererURL,o.viewPort=S.getViewPortSize(),o.userAgent=S.getUserAgent(),o.clientID=S.getClientID(),o.sessionID=S.getSessionID(),e===a?(o.messageID=w,n=!0):o.messageID=S.getGUID(),o.token=k.token,o.version=t,o.userData=k.userData,o.deviceData=l,setTimeout(function(){j(o,n)},0)}var P=[],_=null;function j(e,t){e&&P.push(e),t&&P.length&&(wx.request({url:r,data:P,method:"POST"}),P=[],clearTimeout(_),O())}function O(){_=setTimeout(function(){j(null,!0),O()},n)}O();let A=function(e){function r(e){return e.message||(e=new Error(e)),e.error=e,e.filename=e.filename?e.filename:"",e.filename+=" via frontJS try - catch API",e.lineno=e.lineno?e.lineno:0,e.colno=e.colno?e.colno:0,function(e){if(!e.message)return!0;var r=S.composeScriptErrorData(i,e.message,e.filename,e.lineno,e.colno,e.error);S.checkCrossOrigin(e.filename,k.exclude)&&k.behaviour&o&&E(i,r)}(e),null}return{try:function(){var e=arguments[0],t=arguments[1];try{return e.apply(t,[].slice.call(arguments,2))}catch(e){return r(e)}},catch:r,composedTry:function(e,t){return function(){try{return e.apply(t,[].slice.call(arguments))}catch(e){return r(e)}}},addUserData:function(r,t){return"string"==typeof t||"number"==typeof t||"boolean"==typeof t||null===t?(e.userData[r]=t,!0):(s(1005,r),!1)},removeUserData:function(r){return delete e.userData[r],!0}}}(k);const L={C:{SCRIPT:o,RESOURCE:2,XHR:4,PERFOMACE:8},V:t,try:A.try,catch:A.catch,composedTry:A.composedTry,addUserData:A.addUserData,removeUserData:A.removeUserData};return L};module.exports=tracker;
//# sourceMappingURL=tracker.min.js.map